<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satellite Tracker</title>

    <!-- Load satellite.js from CDN (ensure itâ€™s available) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/satellite.js/1.3.0/satellite.min.js"></script>

    <!-- Use ES module version of Three.js -->
    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.160.0/build/three.module.js';

        // Example TLE data (ISS)
        const tleData = [
            "ISS (ZARYA)",
            "1 25544U 98067A   23147.49328399  .00000269  00000-0  15657-4 0  9997",
            "2 25544  51.6413 110.1302 0006866  47.7469 312.1822 15.54159288562333"
        ];

        // Convert TLE to satellite record
        const satrec = satellite.twoline2satrec(tleData[1], tleData[2]);

        // Setup Three.js scene
        let scene, camera, renderer, satelliteMesh;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Create a simple satellite mesh (sphere)
            const geometry = new THREE.SphereGeometry(0.1, 32, 32);
            const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            satelliteMesh = new THREE.Mesh(geometry, material);
            scene.add(satelliteMesh);

            camera.position.z = 5;
        }

        // Function to update satellite position
        function updateSatellitePosition() {
            const now = new Date();
            const positionAndVelocity = satellite.propagate(satrec, now);
            const positionEci = positionAndVelocity[0];

            // Convert ECI to geodetic coordinates (latitude, longitude, altitude)
            const observerGd = satellite.ecfToGeodetic(positionEci);
            const latitude = observerGd.latitude * (180 / Math.PI);
            const longitude = observerGd.longitude * (180 / Math.PI);
            const altitude = observerGd.height;

            console.log(`Latitude: ${latitude}, Longitude: ${longitude}, Altitude: ${altitude}`);

            // Update satellite mesh position based on the longitude and latitude (simplified conversion for visualization)
            satelliteMesh.position.x = longitude / 180 * 5;
            satelliteMesh.position.y = latitude / 180 * 5;
            satelliteMesh.position.z = altitude / 1000; // Simple altitude scaling
        }

        // Render function for Three.js
        function animate() {
            requestAnimationFrame(animate);
            updateSatellitePosition(); // Update satellite position every frame
            renderer.render(scene, camera);
        }

        // Initialize the scene and start the animation loop
        init();
        animate();

        // Update position every 5 seconds (for logging and updates)
        setInterval(updateSatellitePosition, 5000);
    </script>
</head>
<body>
    <h1>Satellite Tracker</h1>
    <p>Tracking position of the ISS...</p>
</body>
</html>
